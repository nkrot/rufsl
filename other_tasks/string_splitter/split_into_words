#!/usr/bin/env ruby
# -*- coding: utf-8; -*-

require 'string_splitter'
#require 'ru_utf8'

words = %w{в одном старинном рукописном травнике болгарии написано если бы знали мужчины обо всех свойствах сельдерея то бы засадили им весь огород а еще это снижает и отпугивает вредителей капусты используют сельдерей в свежем виде и листья и черешки и корнеплоды из него готовят салаты гарниры к овощным рыбными мясным блюдам они приобретают пряный сладковато-горьковатый вкус и крепкий износа носа с сто стоик тебе ктебе} # аромат растение}

sent = 'ВодномстаринномрукописномтравникеБолгариинаписано:«Еслибызналимужчиныобовсехсвойствахсельдерея,тобызасадилиимвесьогород».Аещеэторастениеснижаетиотпугиваетвредителейкапусты.Используютсельдерейвсвежемвиде–илистья,ичерешки,икорнеплоды.Изнегоготовятсалаты,гарнирыковощным,рыбнымимяснымблюдам.Ониприобретаютпряный,сладковато-горьковатыйвкусикрепкийаромат.'

sent = 'водномстаринномрукописномтравникеболгариинаписано:«еслибызналимужчиныобовсехсвойствахсельдерея,тобызасадилиимвесьогород».аещеэторастениеснижаетиотпугиваетвредителейкапусты.используютсельдерейвсвежемвиде–илистья,ичерешки,икорнеплоды.изнегоготовятсалаты,гарнирыковощным,сторыбнымимяснымблюдам.ониприобретаютпряный,сладковато-горьковатыйвкусикрепкийароматизноса.'

class Dict < Hash
  def words
    keys
  end

  def has? word
    has_key?(word.downcase)
  end
end

dict = Dict.new
words.each{ |w| dict[w] = nil }

splitter = StringSplitter.new
splitter.dictionary = dict
splitter.verbose = !true

splitter.process(sent)

if false
  splitter.result.each do |spl| 
    puts "--- Splitting ---"
    spl.each do |word|
      puts word.inspect
    end
  end
end

puts "---"
sent.chars.each_with_index do |char, pos|
  data = []
  splitter.results.each do |splitting|
    word = splitting.word_at(pos)
    len = word.known? ? word.length : 0
    data << len << pos-word.offset
  end

  puts "#{pos}\t#{char}\t#{data.join("\t")}"
end
